---
title: BOJ 33473 - Bee Tea Again
date: 9999-09-08 14:57:00 +0900
categories: [PS]
tags: []     # TAG names should always be lowercase
toc: false
comments: true
math: true
---

## <boj-problem id=33473 tier='r5' name='Bee Tea Again'></boj-problem>

| 시간 제한 | 메모리 제한 |
|:---------|:---------|
| 2 초 (추가 시간 없음) | 1024 MB (추가 메모리 없음) |

## 문제
<hr>

> 2021년 여름, 동우와 유신이를 중심으로 비공개 대회인 수학과 보안, 알고리즘이 혼합된 대회인 &lt;제1회 CodeComment Cup&gt;이 개최되었다. 그 이후 대회가 사라졌다가, 동우와 재우를 포함한 당시 사이버국방학과 몇몇 학생의 주도로 MatKor가 만들어졌던 2022년 여름, 대회를 부활시키고자 했다. 동우와 재우는 내부 대회로 [<제1회 MatKor Cup : 2022 Summer>](https://www.acmicpc.net/category/detail/4431)를 개최하기로 하였고, &lt;제1회 CodeComment Cup&gt;의 명칭을 &lt;제0회 MatKor Cup&gt;으로 변경하였다.

[<제1회 MatKor Cup : 2022 Summer>](https://www.acmicpc.net/category/detail/4431) 당시 발생한 KOVID-22 바이러스에 이어 KOVID-25 바이러스가 발생하였다!

KOVID-25 바이러스에 감염이 된 사람들은 국가에서 특별히 관리하여 격리한다. 감염된 사람들은 각자 한 명당 하나의 방에 격리되는데, 방들은 직선 형태의 복도에 배치되어 있고, 정수 $i$에 대하여 $i$번 방은 $i$ 이상 $i+1$ 미만의 좌표 범위를 의미한다. 감염된 사람들은 $1$번 방부터 $2$번 방, $3$번 방과 같이 방의 번호가 커지는 순서대로 차례로 격리되며, $0$번 방에는 격리 시설의 관리자 동우가 있다. 또 다른 관리자인 재우는 양이 아닌 정수 $-N(N\ge 0)$번 방에 있다.

KOVID-25 바이러스의 경우 벌집에서 추출한 꿀로 만든 차를 마셔야 금방 낫기 때문에 동우와 재우는 벌꿀차를 만들어 격리자들에게 나누어 주려 한다. 동우와 재우는 각자 보폭에 맞추어 벌꿀차를 나누어 주는데, 동우의 보폭은 $A$, 재우의 보폭은 $B$이다. 구체적으로 동우는 $0$의 좌표, 재우는 $-N$의 좌표에서 출발해 독립적으로 다음과 같이 벌꿀차를 나누어 준다. 처음에 격리자들은 벌꿀차를 가지고 있지 않다.

<img alt="" src="https://upload.acmicpc.net/178e4de1-8566-42ca-8b35-27d71c8b1dfe/-/preview/" style="width: 600px; max-width: 100%;">

1. 먼저 현재 위치에서 오른쪽(양의 방향)으로 각자 보폭만큼 움직인다.
2. 움직인 후 위치한 방에 격리자가 있는지 여부에 따라 다음을 시행한다.
    - 격리자가 있다면 다음을 시행한다. 동우나 재우는 제자리에서 이 행동을 하므로 위치가 변하지 않는다. 이후 1번 행동으로 돌아가 반복한다.
        - 만약 격리자가 벌꿀차를 가지고 있지 않다면, 벌꿀차를 준다.
        - 만약 이미 격리자가 벌꿀차를 가지고 있다면, 벌꿀차를 회수한다.
    - 격리자가 없다면 행동을 종료한다.

동우와 재우의 보폭에 따라 같은 관리자가 같은 방을 여러 번 열 수도 있다는 점에 유의하자.

이때 격리자들의 불만이 생길 수 있으므로, 최종적으로 모든 과정이 끝난 후 모든 격리자가 벌꿀차를 가지고 있도록 하고 싶다. 또한, 격리자가 몇 명이나 될지 모르기 때문에, 아무리 많은 사람이 오더라도 격리자들의 불만이 생기지 않도록 동우와 재우는 보폭을 서로 맞추려 한다. 동우의 보폭이 $A$일 때, 이 조건을 만족하도록 재우의 보폭을 정해보자. 재우는 보폭을 정한 후에, 본인이 있을 방을 정할 것이므로 조건을 만족하는 방이 하나라도 있으면 해당 보폭은 가능한 것으로 생각한다.

또한 동우와 재우의 보폭은
$10^{18}$ 이하의 양의 정수이거나 기약분수로 나타냈을 때, 분모와 분자가 모두 $10^{18}$ 이하인 양의 유리수를 만족해야 한다.

## 입력
<hr>
첫 번째 줄에 테스트 케이스의 개수 $T(1\le T\le 10^6)$가 주어진다.

각 테스트 케이스의 첫 번째 줄에 동우의 보폭을 나타내는 서로소인 두 양의 정수 $P,Q(1\le P,Q\le 10^{18})$가 공백으로 구분되어 주어진다. 이는 $A=\frac{Q}{P}$라는 의미이다.

## 출력
<hr>
각 테스트 케이스의 첫 번째 줄에 조건을 만족하는 재우의 보폭으로 가능한 개수를 출력한다.

## 풀이 과정
<hr>

일단 지문이 좀 복잡하므로 지문 정리를 다시 할 필요가 있다. $$\newcommand\set[1][]{\left\{ {#1} \right\}} \newcommand\setof[2][]{\left\{ {#1:{\small #2}} \right\}} \newcommand\floor[2][]{\left\lfloor{#2}\right\rfloor} \newcommand\ceil[2][]{\left\lceil{#2}\right\rceil} \newcommand\abs[2][]{\left\lvert{#2}\right\rvert}$$

$T \geq 0$번째 행동에서,
- 동우는 $\floor{A \cdot T}$번째 방에 위치한다.
- 재우는 $\floor{B \cdot T - N}$번째 방에 위치한다.

여기서 $A, B$는 모두 양의 유리수이므로 $A = \dfrac{q_A}{p_A}, B = \dfrac{q_B}{p_B}$라고 하자. 문제에 따라 각 방에 재우와 동우가 방문한 횟수의 합이 홀수여야 한다. 

이를 간단히 나타내기 위해 새로운 함수 <span style="background-color: #00ff0033">$C(q/p, n) :=$ 보폭이 $q/p$이고 0번째 방에서 출발할 때 $n$번째 방을 방문하는 횟수</span>를 정의하자. 즉, 

$$ C(q/p, n) = \abs{\setof[i]{\floor{\frac{qi}{p}} = n}} $$

이다. 이제 문제에서 주어진 것을 $C$를 통해 다시 표현하면, 

> $q_A/p_A$가 주어질 때, 모든 정수 $n \geq 0$에 대해서,
> 
> $C(q_A/p_A, n) + C(q_B/p_B, n+N) \equiv 1 \pmod{2}$
> 
> 를 만족시키는 정수 $N \geq 0$이 존재하는 $q_B/p_B$의 개수를 구하라

가 되는 것을 알 수 있다. 다음은 이해를 돕기 위한 시각 자료이다. (주어진 $A$와 $B$는 위 조건을 만족하지 않음을 유의하라.)

![예시 자료](/assets/img/33473/img1.png)

여러 $q/p$에 대해 위 함숫값들을 계산해보면 여러 성질들을 쉽게 관찰할 수 있을 것이다. 이를테면,
- 기약분수 $q/p$에 대해 $C(q/p, n)$의 주기는 $q$이고, $C(q/p, 0) + \cdots + C(q/p,q-1) = p$이다.
- $C(q/p, n)$과 $C(q/(p+q), n)$의 패턴이 유사하다. 
- ...

같은 것이다. 이러한 관찰만 잘 해도 충분히 이 문제를 해결할 수 있지만, 이 글에서는 증명까지 하는 것을 목표로 삼으므로 다음의 간단한 성질부터 보이자.

**Theorem 1.** $C(q/p, n) = C(q/p, n \pm q)$

*Proof.* $\floor{qx/p} = n$라면 $\floor{q(x \pm p)/p} = \floor{qx/p \pm q} = \floor{qx/p} \pm q.$
<br>
$C(q/p, n) = \abs{\setof[i]{\floor{\frac{qi}{p}} = n}}$이고 $C(q/p, n \pm q) = \abs{\setof[i]{\floor{\frac{qi}{p}} = n \pm q}}$이므로 성립한다.

즉, $C(q/p, x)$는 최대 $q$를 주기로 반복된다. (주기가 $d$라면, 정수 $k$에 대해 $dk = q$가 성립한다.)

**Theorem 2.** $C(q/p, n) = \floor{\dfrac{pn+p}{q}} - \floor{\dfrac{pn}{q}}$

*Proof.* $\floor{\dfrac{qx}{p}} = n \Leftrightarrow n \leq \dfrac{qx}{p} < n+1$이므로 정리하면 $\frac{pn}{q} \leq x < \frac{p(n+1)}{q}$.
<br>
이때 $x$가 정수이므로 $\floor{\frac{pn}{q}} \leq x < \floor{\frac{p(n+1)}{q}}$. 따라서 조건을 만족하는 $x$는 $\floor{\frac{p(n+1)}{q}} - \floor{\frac{pn}{q}}$개 존재한다.

**Theorem 3.** $q/p$가 기약분수일 때, $C(q/p, x)$의 주기는 정확히 $q$이다.

*Proof.* 주기 $d$는 모든 정수 $x$에 대해 $C(q/p, x+d) = C(q/p, x)$를 만족하는 최소의 정수이므로 
$C(q/p, x+d) = \floor{\dfrac{px+p+pd}{q}} - \floor{\dfrac{px+pd}{q}} = \floor{\dfrac{px+p}{q}} - \floor{\dfrac{px}{q}} = C(q/p, x)$이다. 이때, $q \nmid d$라고 가정하자. 